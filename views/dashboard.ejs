<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title><%= title %></title>

    <!-- DataTables e Bootstrap -->
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/1.13.1/css/jquery.dataTables.min.css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Inter Font -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@600&display=swap"
      rel="stylesheet"
    />

    <!-- Favicon -->
    <link rel="icon" href="/assets/imgs/small_ufc_logo.png" type="image/x-icon">

    <!-- Estilos customizados -->
    <link rel="stylesheet" href="/assets/css/index.css" />
    <!-- FontAwesome -->
    <script
      src="https://kit.fontawesome.com/0c23645969.js"
      crossorigin="anonymous"
    ></script>
  </head>

  <body class="d-flex justify-content-center align-items-center">
    <header>
      <%- include('components/header.ejs') %>
    </header>

    <!-- Sidebar -->
    <aside class="sidebar-container">
      <%- include('components/sideBar.ejs') %>
    </aside>

    <main class="content p-4">
      <h1 class="mb-4 text-start">Dashboard</h1>
      
      <% if (error) { %>
        <div class="alert alert-danger" role="alert">
          <%= error %>
        </div>
      <% } %>

      <!-- Formulário para Adicionar Novo Documento -->
      <div class="mb-5">
        <form
          class="form-upload"
          action="/addDocument"
          method="POST"
          enctype="multipart/form-data"
          onsubmit="return validar()"
          novalidate
        >
          <div class="row d-flex flex-row justify-content-between align-items-center">
            <div class="col-5 mb-3">
              <label for="documentName">Link do Documento</label>
              <input
                type="text"
                class="form-control"
                id="documentLink"
                name="documentLink"
                placeholder="Exemplo: 'https://www.ufc.br/noticias/noticias-e-editais-de-concursos-e-selecoes'"
                required
              />
            </div>
            <div class="col-2 d-flex justify-content-center align-items-center">
              <p class="text-center m-0">ou</p>
            </div>
            <div class="col-5 mb-3 custom-file-button">
              <label for="documentFile">Arquivo PDF</label>
              <div class="input-file-wrapper d-flex align-items-center">
                <input
                type="file"
                class="form-control"
                id="documentFile"
                name="documentFile"
                accept=".pdf"
                required
              />
              <label for="documentFile">
                <i class="fa-solid fa-paperclip ms-3 attachment-icon"></i> <!-- Ícone de anexo -->
              </label>
              </div>
            </div>
          </div>

          <button type="submit" class="btn btn-success">
            Adicionar
          </button>
        </form>
      </div>

      <!-- Tabela de Uploads -->
      <table id="example" class="table table-striped table-dark">
        <thead>
          <tr>
            <th>Ações</th>
            <th>Nome</th>
            <th>Tipo</th>
            <th>Data de Inserção</th>
            <th>Usuário</th>
          </tr>
        </thead>
        <tbody>
          <% if (sources && sources.length > 0) { %>
            <% sources.forEach(source => { %>
              <tr>
                <td class="text-center">
                  <form method="POST" action="/delete/by-source" style="display: inline;" onsubmit="return confirm('Tem certeza que deseja excluir este documento?')">
                    <input type="hidden" name="source" value="<%= source.source || source.name %>">
                    <button type="submit" class="btn btn delete-document" title="excluir documento">
                      <i class="fa-solid fa-trash"></i>
                    </button>
                  </form>
                </td>
                <td><%= source.source || 'Documento' %></td>
                <td><%= source.tipo || 'Documento' %></td>
                <td>
                  <% if (source.insertion_time) { %>
                    <%= source.insertion_time %>
                  <% } else if (source.data_insercao) { %>
                    <%= source.data_insercao %>
                  <% } else if (source.data_adicao) { %>
                    <%= source.data_adicao %>
                  <% } else { %>
                    N/A
                  <% } %>
                </td>
                <td><%= source.user || userName %></td>
              </tr>
            <% }); %>
          <% } %>
        </tbody>
      </table>
    </main>

    <!-- Scripts do DataTables -->
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <script src="https://cdn.datatables.net/1.13.1/js/jquery.dataTables.min.js"></script>
    <script>

      $(document).ready(function () {
        $("#example").DataTable({
          order: [[3, "desc"]],
          pageLength: 5, // Número de itens por página
          language: {
            url: "/assets/js/datatables/Portuguese.json", // Caminho local para o arquivo
          },
        });
      });

      function validar() {  
        let link = window.document.getElementById('documentLink');
        let pdf = window.document.getElementById('documentFile');
        let ok = true;

        if (!link.value && !pdf.value) {
          window.alert('Preencha um dos campos')
          ok = false;
        }
        if (((link.value || pdf.value) && (link.value && pdf.value))) {
          window.alert('Selecione apenas um link ou um PDF')
          ok = false;
        }
        
        return ok;
      }


    </script>
  </body>
</html>
